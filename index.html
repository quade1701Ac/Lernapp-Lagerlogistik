<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Lernapp Lagerlogistik – Deploy</title>
  <meta name="theme-color" content="#0E3A8A"/>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
:root{--bg:#0b1020;--bg2:#0e1428;--panel:rgba(255,255,255,.06);--line:rgba(255,255,255,.12);
--text:#E5E7EB;--muted:#A7B0C3;--primary:#60A5FA;--accent:#F59E0B;--ok:#22C55E;--err:#EF4444;}
*{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;color:var(--text);
background:radial-gradient(1200px 800px at 10% -10%, rgba(96,165,250,.20), transparent 50%), radial-gradient(1200px 800px at 110% 10%, rgba(245,158,11,.12), transparent 50%), linear-gradient(180deg, var(--bg), var(--bg2));}
.topbar{position:sticky;top:0;display:flex;justify-content:space-between;align-items:center;gap:16px;padding:14px 18px;border-bottom:1px solid var(--line);
background:linear-gradient(180deg, rgba(10,14,28,.9), rgba(10,14,28,.7));backdrop-filter:blur(8px);z-index:10}
.brand{display:flex;gap:12px;align-items:center} .brand .logo{height:36px;width:36px;border-radius:9px;background:conic-gradient(from 0deg,#60A5FA,#F59E0B,#60A5FA)}
.brand h1{font-size:18px;margin:0} .subtitle{margin:2px 0 0 0;color:var(--muted);font-size:12px}
.nav{display:flex;gap:8px;flex-wrap:wrap} .nav-btn{background:transparent;color:var(--text);border:1px solid var(--line);padding:8px 12px;border-radius:12px;cursor:pointer;transition:all .2s}
.nav-btn:hover{border-color:var(--primary);box-shadow:0 0 0 4px rgba(96,165,250,.15)}
main{padding:24px} .container{max-width:980px;margin:0 auto} .view{display:none} .view.active{display:block}
.panel{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
.panel-title{margin:0 0 8px 0} .grid-2{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
input,select,textarea{background:rgba(255,255,255,.04);color:var(--text);border:1px solid var(--line);border-radius:12px;padding:10px 12px}
textarea{resize:vertical} input::placeholder,textarea::placeholder{color:#94A3B8}
.btn{border-radius:12px;padding:10px 14px;cursor:pointer;border:1px solid transparent;transition:all .2s}
.btn.primary{background:linear-gradient(180deg,#3B82F6,#2563EB);color:#fff} .btn.ghost{background:transparent;border-color:var(--line);color:var(--text)}
.btn[disabled]{opacity:.6;cursor:not-allowed} .muted{color:var(--muted)}
.badge{background:rgba(96,165,250,.15);border:1px solid var(--line);padding:2px 8px;border-radius:999px;color:var(--text);font-size:12px}
.cards{max-width:900px;margin:0 auto;display:grid;gap:16px} .card{border:1px solid var(--line);border-radius:14px;padding:16px 14px;background:rgba(255,255,255,.04)}
.card-head{display:flex;justify-content:space-between;align-items:center;gap:10px;margin-bottom:8px}
.qwrap{display:grid;grid-template-columns:1fr auto;gap:16px;align-items:start}
.card-img{max-width:200px;max-height:200px;border:1px solid var(--line);border-radius:10px;background:rgba(255,255,255,.02)}
.options{display:grid;gap:10px} .option{display:grid;grid-template-columns:24px 1fr;align-items:center;gap:10px;padding:12px;border:1px solid var(--line);border-radius:12px;cursor:pointer;background:rgba(255,255,255,.02)}
.option:hover{border-color:var(--primary);box-shadow:0 0 0 3px rgba(96,165,250,.15)} .option.selected{outline:2px solid var(--primary);background:rgba(96,165,250,.10)}
.option input[type=radio]{width:18px;height:18px;margin:0} .reveal{margin-top:10px;padding:10px 12px;border-radius:12px;border:1px solid var(--line)}
.reveal.ok{background:rgba(34,197,94,.13);border-color:rgba(34,197,94,.45)} .reveal.err{background:rgba(239,68,68,.15);border-color:rgba(239,68,68,.45)}
.options.locked{pointer-events:none;opacity:.8} .footer{padding:24px;text-align:center;color:var(--muted)}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:50} .modal.show{display:flex}
.modal .box{width:min(720px,calc(100% - 32px));background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:16px}
.alert{border:1px dashed var(--line);background:rgba(255,255,255,.03);padding:12px;border-radius:12px}
  </style>
</head>
<body>
  <header class="topbar">
    <div class="brand"><span class="logo"></span><div><h1>Lernapp Lagerlogistik</h1><p class="subtitle">Supabase • Login • Cloud‑Speicherung</p></div></div>
    <nav class="nav">
      <button class="nav-btn" type="button" data-view="login">Login</button>
      <button class="nav-btn" type="button" data-view="flashcards">Lernkarten</button>
      <button class="nav-btn" type="button" data-view="exam">Prüfung</button>
      <button class="nav-btn" type="button" data-view="progress">Fortschritt</button>
      <button class="nav-btn" type="button" data-view="admin">Admin</button>
      <button id="btn-settings" class="nav-btn" type="button">Einstellungen</button>
    </nav>
  </header>

  <main>
    <div class="container">
      <div id="settings-modal" class="modal">
        <div class="box">
          <h2>Supabase & Branding</h2>
          <p class="muted">Die Felder sind bereits mit deinem Projekt vorbefüllt. Du kannst sie jederzeit ändern.</p>
          <div class="grid-2">
            <label>Project URL<input id="cfg-url" placeholder="https://YOUR-PROJECT.supabase.co"/></label>
            <label>Anon public key<input id="cfg-key" placeholder="ey..."/></label>
          </div>
          <label>Logo URL / Data‑URI<input id="cfg-logo" placeholder="https://.../logo.png oder data:image/png;base64,..."/></label>
          <div class="row" style="margin-top:10px">
            <button id="cfg-save" class="btn primary" type="button">Speichern</button>
            <button id="cfg-close" class="btn ghost" type="button">Schließen</button>
            <span id="cfg-state" class="muted"></span>
          </div>
        </div>
      </div>

      <section id="view-login" class="view active">
        <div class="panel">
          <h2 class="panel-title">Anmelden</h2>
          <div class="grid-2">
            <label>E‑Mail<input id="email" type="email" placeholder="dein.name@example.com"/></label>
            <label>Passwort<input id="password" type="password" placeholder="••••••••"/></label>
          </div>
          <div class="row">
            <button id="btn-signup" class="btn ghost" type="button">Registrieren</button>
            <button id="btn-login" class="btn primary" type="button">Einloggen</button>
            <button id="btn-logout" class="btn ghost" type="button" disabled>Abmelden</button>
            <span id="auth-state" class="muted"></span>
          </div>
          <div id="login-empty-info" class="alert" style="display:none;margin-top:12px"></div>
        </div>
      </section>

      <section id="view-flashcards" class="view">
        <div class="panel">
          <div class="row" style="justify-content:space-between;align-items:end;">
            <h2 class="panel-title">Lernkarten</h2>
            <div class="row">
              <label>Kategorie <select id="fc-category"></select></label>
              <button id="fc-load" class="btn primary" type="button">Laden</button>
              <span id="fc-stats" class="muted"></span>
            </div>
          </div>
          <div id="fc-area" class="cards"></div>
          <div id="fc-empty" class="alert" style="display:none;margin-top:12px"></div>
        </div>
      </section>

      <section id="view-exam" class="view">
        <div class="panel">
          <div class="row" style="justify-content:space-between;align-items:end;">
            <h2 class="panel-title">Prüfungssimulation</h2>
            <div class="row">
              <label>Kategorien <select id="exam-categories" multiple></select></label>
              <label>Anzahl <input id="exam-count" type="number" value="20" min="5" max="100" style="width:90px"/></label>
              <button id="exam-start" class="btn primary" type="button">Start</button>
              <button id="exam-reset" class="btn ghost" type="button">Reset</button>
            </div>
          </div>
          <div id="exam-area" class="cards"></div>
        </div>
      </section>

      <section id="view-progress" class="view">
        <div class="panel">
          <div class="row" style="justify-content:space-between;align-items:end;">
            <h2 class="panel-title">Dein Fortschritt</h2>
            <button id="reset-progress" class="btn ghost" type="button">Lokalen Fortschritt zurücksetzen</button>
          </div>
          <div id="progress-summary" class="cards"></div>
        </div>
      </section>

      <section id="view-admin" class="view">
        <div class="panel">
          <div class="row" style="justify-content:space-between;align-items:end;">
            <h2 class="panel-title">Admin</h2>
            <div class="row">
              <button id="admin-export" class="btn ghost" type="button">Export JSON (alle Fragen)</button>
              <input type="file" id="admin-import" accept="application/json"/>
            </div>
          </div>
          <div id="admin-tip" class="alert" style="display:none">Noch keine Fragen in der Datenbank. Importiere deine JSON im Admin‑Bereich.</div>
          <form id="admin-form" class="form" onsubmit="return false;">
            <h3>Neue Frage</h3>
            <label>Kategorie<input type="text" id="ad-category" placeholder="z.B. LL01/2 – Güter kontrollieren" required/></label>
            <label>Frage<textarea id="ad-question" rows="2" required></textarea></label>
            <label>Antworten (eine pro Zeile, richtige mit '***' markieren)<textarea id="ad-options" rows="5" placeholder="***Korrekt
Falsch 1
Falsch 2" required></textarea></label>
            <label>Erklärung (optional)<textarea id="ad-expl" rows="2"></textarea></label>
            <div class="row"><button id="admin-save" class="btn primary" type="submit">Speichern (DB)</button></div>
          </form>
          <div id="admin-list" class="cards"></div>
        </div>
      </section>
    </div>
  </main>

  <footer class="footer"><span>© Lernapp Lagerlogistik – Supabase Version</span></footer>

<script>
const views=['login','flashcards','exam','progress','admin'];
function showView(id){views.forEach(v=>document.getElementById('view-'+v).classList.toggle('active',v===id));}
document.querySelectorAll('.nav-btn').forEach(b=>b.addEventListener('click',()=>showView(b.dataset.view)));
const letters=['A','B','C','D','E','F']; const shuffle=a=>{const b=a.slice();for(let i=b.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[b[i],b[j]]=[b[j],b[i]];}return b;};

// Settings & Supabase client
const KEY_URL='supabase_url', KEY_ANON='supabase_anon', KEY_LOGO='app_logo_url'; let supa=null;
(function prefill(){ if(!localStorage.getItem(KEY_URL)) localStorage.setItem(KEY_URL,"https://ebqfupcivmkbuadbbnwg.supabase.co"); if(!localStorage.getItem(KEY_ANON)) localStorage.setItem(KEY_ANON,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVicWZ1cGNpdm1rYnVhZGJibndnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ5MDA5ODIsImV4cCI6MjA3MDQ3Njk4Mn0.P6IiwjFSpqVmObRbvxvY46l6vJlPsxPAc-wbr15Dhl0"); })();
async function initClient(){ const url=localStorage.getItem(KEY_URL)||''; const anon=localStorage.getItem(KEY_ANON)||'';
  if(!url||!anon){document.getElementById('settings-modal').classList.add('show'); return;}
  supa=supabase.createClient(url,anon); refreshAuthUI(); await refreshSelectors(); await refreshExamCategories(); await renderAdminList(); await showEmptyHints(); }
document.getElementById('btn-settings')?.addEventListener('click',()=>{document.getElementById('settings-modal').classList.add('show');
  document.getElementById('cfg-url').value=localStorage.getItem(KEY_URL)||''; document.getElementById('cfg-key').value=localStorage.getItem(KEY_ANON)||''; document.getElementById('cfg-logo').value=localStorage.getItem(KEY_LOGO)||'';});
document.getElementById('cfg-close')?.addEventListener('click',()=>document.getElementById('settings-modal').classList.remove('show'));
document.getElementById('cfg-save')?.addEventListener('click',()=>{ const url=document.getElementById('cfg-url').value.trim(); const key=document.getElementById('cfg-key').value.trim(); const logo=document.getElementById('cfg-logo').value.trim();
  if(!url||!key) return alert('Bitte URL und anon key eintragen.'); localStorage.setItem(KEY_URL,url); localStorage.setItem(KEY_ANON,key);
  if(logo) localStorage.setItem(KEY_LOGO,logo); else localStorage.removeItem(KEY_LOGO); document.getElementById('cfg-state').textContent='Gespeichert. Lade neu...'; setTimeout(()=>location.reload(),400); });

// Auth
const email=document.getElementById('email'); const password=document.getElementById('password'); const btnSignup=document.getElementById('btn-signup'); const btnLogin=document.getElementById('btn-login'); const btnLogout=document.getElementById('btn-logout'); const authState=document.getElementById('auth-state'); const loginEmptyInfo=document.getElementById('login-empty-info');
async function refreshAuthUI(){ const {data:{user}}=await supa.auth.getUser(); if(user){btnLogout.disabled=false;btnLogin.disabled=true;btnSignup.disabled=true;authState.textContent=`Eingeloggt: ${user.email}`;} else {btnLogout.disabled=true;btnLogin.disabled=false;btnSignup.disabled=false;authState.textContent='Nicht eingeloggt';} }
btnSignup?.addEventListener('click',async()=>{const {error}=await supa.auth.signUp({email:email.value,password:password.value}); if(error) alert(error.message); else alert('Registrierung erfolgreich. Prüfe ggf. dein Postfach.'); refreshAuthUI();});
btnLogin?.addEventListener('click',async()=>{const {error}=await supa.auth.signInWithPassword({email:email.value,password:password.value}); if(error) alert(error.message); await refreshAuthUI();});
btnLogout?.addEventListener('click',async()=>{await supa.auth.signOut(); await refreshAuthUI();});

// Questions
async function fetchQuestions(){ const {data,error}=await supa.from('questions').select('*').order('category',{ascending:true}); if(error){alert('Fehler Fragen laden: '+error.message); return [];} return data||[]; }
async function fetchCategories(){const q=await fetchQuestions(); return [...new Set(q.map(x=>x.category))].sort();}
const fcCategory=document.getElementById('fc-category'); const fcArea=document.getElementById('fc-area'); const fcStats=document.getElementById('fc-stats'); const fcEmpty=document.getElementById('fc-empty');
document.getElementById('fc-load')?.addEventListener('click',loadFlashcards);
async function refreshSelectors(){ if(!supa) return; const cats=await fetchCategories(); if(fcCategory) fcCategory.innerHTML=cats.map(c=>`<option>${c}</option>`).join(''); }
async function loadFlashcards(){ const all=await fetchQuestions(); const cat=fcCategory.value; const cards=all.filter(x=>x.category===cat);
  fcArea.innerHTML=''; if(cards.length===0){ fcEmpty.style.display='block'; fcEmpty.innerHTML='Keine Fragen in dieser Kategorie. Gehe zu <b>Admin → Import</b> und lade deine JSON-Dateien.'; fcStats.textContent='0 Karten'; return; } else fcEmpty.style.display='none';
  let activeCount=0; cards.forEach(card=>{ const wrap=document.createElement('div'); wrap.className='card'; const opts=shuffle(card.options.map((t,i)=>({text:t,correct:i===card.correct_index})));
    wrap.innerHTML=`<div class="card-head"><div><span class="badge">${card.category}</span></div><div class="muted">ID: ${card.id}</div></div>
    <div class="qwrap"><div><h3>${card.question}</h3><div class="options"></div><div class="row" style="margin-top:10px"><button class="btn primary check" type="button" disabled>Prüfen</button><button class="btn ghost next" type="button">Weiter</button></div><div class="reveal" style="display:none"></div></div>${card.image?`<img class="card-img" src="${card.image}"/>`:''}</div>`;
    const box=wrap.querySelector('.options'); let selected=-1; opts.forEach((o,idx)=>{ const el=document.createElement('div'); el.className='option';
      el.innerHTML=`<input type="radio"/><span><b>${['A','B','C','D','E','F'][idx]||''}.</b> ${o.text}</span>`;
      el.addEventListener('click',()=>{ selected=idx; [...box.children].forEach(c=>c.classList.remove('selected')); el.classList.add('selected'); wrap.querySelector('.check').disabled=false; });
      box.appendChild(el); });
    wrap.querySelector('.check').addEventListener('click',async()=>{ if(selected<0) return alert('Bitte eine Antwort wählen.');
      const chosen=opts[selected]; const reveal=wrap.querySelector('.reveal'); reveal.style.display='block'; const solution=opts.find(o=>o.correct)?.text;
      reveal.textContent=chosen.correct?'✅ Richtig!':`❌ Falsch. Richtige Antwort: ${solution}`; reveal.classList.toggle('ok',chosen.correct); reveal.classList.toggle('err',!chosen.correct);
      const {data:{user}}=await supa.auth.getUser(); if(user) await supa.from('reviews').insert({user_id:user.id,question_id:card.id,correct:chosen.correct});
    });
    wrap.querySelector('.next').addEventListener('click',()=>wrap.remove()); fcArea.appendChild(wrap); activeCount++; }); fcStats.textContent=`${activeCount} Karten geladen`; }

// Exam
const examCategories=document.getElementById('exam-categories'); const examCount=document.getElementById('exam-count'); const examStart=document.getElementById('exam-start'); const examReset=document.getElementById('exam-reset'); const examArea=document.getElementById('exam-area');
async function refreshExamCategories(){ if(!supa) return; const cats=await fetchCategories(); if(examCategories) examCategories.innerHTML=cats.map(c=>`<option value="${c}" selected>${c}</option>`).join(''); }
function pickN(arr,n){ const a=shuffle(arr); return a.slice(0,Math.max(0,Math.min(n,a.length))); }
examStart?.addEventListener('click',async()=>{ const all=await fetchQuestions(); const chosen=[...examCategories.selectedOptions].map(o=>o.value);
  const pool=all.filter(q=>chosen.includes(q.category)); const n=Math.max(5,Math.min(Number(examCount.value||20),100)); const pick=pickN(pool,n);
  if(pick.length===0){ alert('Keine Fragen gefunden. Bitte importiere Fragen im Admin‑Bereich.'); return; } const {data:{user}}=await supa.auth.getUser(); if(!user) return alert('Bitte zuerst einloggen.');
  const session={items:[],total:n,correct:0}; examArea.innerHTML='';
  pick.forEach((q,idx)=>{ const el=document.createElement('div'); el.className='card'; const opts=shuffle(q.options.map((t,i)=>({text:t,correct:i===q.correct_index})));
    el.innerHTML=`<div class="card-head"><div><span class="badge">${q.category}</span></div><div class="muted">Frage ${idx+1} von ${n}</div></div>
    <div class="qwrap"><div><h3>${q.question}</h3><div class="options"></div><div class="row" style="margin-top:10px"><button class="btn primary check" type="button" disabled>Antwort prüfen</button></div><div class="reveal" style="display:none"></div></div>${q.image?`<img class="card-img" src="${q.image}"/>`:''}</div>`;
    const box=el.querySelector('.options'); let selected=-1,locked=false; opts.forEach((o,i)=>{ const d=document.createElement('div'); d.className='option';
      d.innerHTML=`<input type="radio"/><span><b>${['A','B','C','D','E','F'][i]||''}.</b> ${o.text}</span>`;
      d.addEventListener('click',()=>{ if(locked) return; selected=i; [...box.children].forEach(c=>c.classList.remove('selected')); d.classList.add('selected'); el.querySelector('.check').disabled=false; });
      box.appendChild(d); });
    el.querySelector('.check').addEventListener('click',()=>{ if(locked) return; if(selected<0) return alert('Bitte wählen.');
      locked=true; box.classList.add('locked'); box.querySelectorAll('input[type=radio]').forEach(r=>r.disabled=true);
      const chosen=opts[selected]; const reveal=el.querySelector('.reveal'); reveal.style.display='block'; reveal.textContent=chosen.correct?'✅ Richtig':'❌ Falsch';
      reveal.classList.toggle('ok',chosen.correct); reveal.classList.toggle('err',!chosen.correct); session.items.push({qid:q.id,selected:opts[selected].text,correct:chosen.correct});
      if(chosen.correct) session.correct++; const btn=el.querySelector('.check'); btn.disabled=true; btn.textContent='Gewertet'; refreshFinish(); });
    examArea.appendChild(el); });
  const footer=document.createElement('div'); footer.className='row'; const finish=document.createElement('button'); finish.className='btn primary'; finish.textContent='Ergebnis anzeigen'; finish.disabled=true;
  footer.appendChild(finish); examArea.appendChild(footer);
  function refreshFinish(){ const done=Array.from(examArea.querySelectorAll('.card .check')).every(b=>b.disabled); finish.disabled=!done; }
  finish.addEventListener('click',async()=>{ const percent=Math.round((session.correct/session.total)*100); alert(`Ergebnis: ${session.correct}/${session.total} (${percent}%)`);
    await supa.from('exam_sessions').insert({total:session.total,correct:session.correct,detail:session.items}); });
});
examReset?.addEventListener('click',()=> examArea && (examArea.innerHTML=''));

// Progress
const progressSummary=document.getElementById('progress-summary');
document.getElementById('reset-progress')?.addEventListener('click',()=>{ localStorage.removeItem('progress_local'); renderProgress(); });
function renderProgress(){ const p=JSON.parse(localStorage.getItem('progress_local')||'{"seen":0,"correct":0}'); const acc=p.seen?Math.round(p.correct/p.seen*100):0;
  progressSummary.innerHTML=`<div class="card"><div class="card-head"><b>Letzte Sitzung</b></div><div>Beantwortet: <b>${p.seen}</b> • Richtig: <b>${p.correct}</b> • Trefferquote: <b>${acc}%</b></div></div>`; }
renderProgress();

// Admin
const adminList=document.getElementById('admin-list'); const adminTip=document.getElementById('admin-tip');
async function renderAdminList(){ if(!supa) return; const q=await fetchQuestions();
  adminList.innerHTML=q.map(x=>`<div class="card"><div class="card-head"><div><span class="badge">${x.category}</span></div><div class="row"><button data-del="${x.id}" class="btn ghost" type="button">Löschen</button></div></div><div><b>${x.question}</b></div></div>`).join('');
  adminTip.style.display=q.length===0?'block':'none'; adminList.querySelectorAll('button[data-del]').forEach(btn=>{ btn.addEventListener('click',async()=>{ const id=btn.getAttribute('data-del');
    const {error}=await supa.from('questions').delete().eq('id',id); if(error) alert(error.message); else renderAdminList(); }); });
}
document.getElementById('admin-save')?.addEventListener('click',async()=>{ const cat=document.getElementById('ad-category').value.trim();
  const q=document.getElementById('ad-question').value.trim(); const optsRaw=document.getElementById('ad-options').value.split('\n').map(s=>s.trim()).filter(Boolean);
  const idx=optsRaw.findIndex(s=>s.startsWith('***')); if(idx<0) return alert('Markiere die richtige Antwort mit ***.');
  const opts=optsRaw.map(s=>s.replace(/^\*{3}/,'')); const expl=(document.getElementById('ad-expl').value||'').trim()||null;
  const id='q_'+Math.random().toString(36).slice(2,10); const {error}=await supa.from('questions').insert({id,category:cat,question:q,options:opts,correct_index:idx,explanation:expl});
  if(error) alert(error.message); else { alert('Gespeichert.'); renderAdminList(); await refreshSelectors(); await refreshExamCategories(); }
});
document.getElementById('admin-export')?.addEventListener('click',async()=>{ const q=await fetchQuestions(); const data=JSON.stringify(q,null,2);
  const blob=new Blob([data],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='fragen_export_supabase.json'; a.click(); URL.revokeObjectURL(url); });
document.getElementById('admin-import')?.addEventListener('change',async(e)=>{ const file=e.target.files?.[0]; if(!file) return; const text=await file.text();
  try{ const data=JSON.parse(text); if(!Array.isArray(data)) throw new Error('Erwarte Array von Fragen');
    const cleaned=data.map(x=>{ const {deck,...rest}=x||{}; return {...rest, id: rest.id || ('q_'+Math.random().toString(36).slice(2,10))}; });
    for (const item of cleaned){ const {error}=await supa.from('questions').upsert(item,{onConflict:'id'}); if(error) console.warn('Fehler bei',item.id,error.message); }
    alert('Import abgeschlossen.'); renderAdminList(); await refreshSelectors(); await refreshExamCategories();
  }catch(err){ alert('Import fehlgeschlagen: '+err.message); }
});

async function showEmptyHints(){ const all=await fetchQuestions(); const has=all.length>0; const hint=document.getElementById('login-empty-info');
  if(!has){ hint.style.display='block'; hint.innerHTML='Noch keine Fragen in der Datenbank. Gehe zu <b>Admin → Import</b> und lade deine JSON‑Dateien (Deck wird ignoriert).'; }
  else hint.style.display='none';
}

window.addEventListener('DOMContentLoaded', initClient);
</script>
</body>
</html>
